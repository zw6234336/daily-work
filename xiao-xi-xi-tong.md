---
zhang: null
---

2017年12月28日 15:21:00

**职责**

负责各个平台微信消息、app消息、系统消息发送。

**关键点**

业务场景适配，消息时间精确性、发送质量的准确（预计是会有大量的job需要），后台页面开发规范快速性

1. 业务场景适配：这个肯定会涉及到多个系统提供指标性数据。通过定义消息或者是营销规则发送消息，

   1. 视图：好处消息系统减少表结构基础代码开发（这个现在不是问题）。第三方系统开发量相对减少。缺点 依赖第三方。如果挂掉影响范围很大。

   2. 消息系统建表：好处业务查询快，相对独立运行依赖更少。缺点 系统间交互数据存在网络限制，对两个系统间交互设计要求很高。

2. 消息质量

   1. 时间准确 微信和app消息发送问题（弹性服务发送）研究一下微信后台功能发送整体的提问消息很快
   2. 数据准确 嵌入MQ 接收回执消息（消息成为强依赖接口MQ可能不合适）

3. 使用新后台页面

   1. 有更快的开发速度。和更好的样式

---

2018年4月20日 16:34:52

[文章来源](https://tech.meituan.com/23期张子鑫沙龙速记.html)

从美团只有消息系统彻底放弃业务才能实现高效率处理消息的推送。采用消息队列，根本不需要开启线程池，在action层监听消息队列。直接使用容器的线程池就ok。还是不够处理添加一台机器就ok了。由mq来帮你做reblance。采用接口方式也是同样的问题。消息系统不负责查表。只处理消息。每个接口都是异步话，记录消息内容，选择性是否重发。

这个系统的关键是抽象出通用功能和业务进行解耦。业务由业务处理封装.

kafka的topic 划分可以是按照服务商来划分。泛华可能业务量很大，我们配置对应的patition会多一点。我们的consumer group成员也会相应的变多。这样添加新服务商进来时只需要修改配置文件中组名称即可。中间的消息业务全部通用话。短信消息通用化。app消息也应该配置无关话。微信消息也应该是配置无关话。全部都在数据库中，使用后持久到redis中。失效采用接口方式更新缓存。

放弃配置文件形式，这样更能服务化配置话。数据库可以配置文件话，当前分库的可能行很小。消息系统上线后再去研究。在逻辑上通用话。

accesstoken的问题，我存这个意义也是不大。只是在第一次调用的时候请求一下，然后缓存，失效的时候暂停。这个影响会很大（暂时的思路是 失效调用业务接口获取当前的token,消息系统缓存，发送消息时调用缓存，这块可以再加一个锁当有一个线程去调用业务接口获取token时其他线程只能轮询等待，然后继续读取缓存数据发送消息）

